!function(e){e.preload=function(){for(var o=[],t=arguments.length;t--;)o.push(e("<img />").attr("src",arguments[t]))}}(jQuery);var home1=$(".part1.earth .house_layer_1"),home2=$(".part1.earth .house_layer_2"),home3=$(".part1.earth .house_layer_3"),earth=$(".part1.earth .land"),title=$(".part1 h1"),redword=$(".part1 h2"),content=$(".part1 .pc_only, .part1 .m_only"),startBtn=$(".part1 .btn"),indexBtn=$(".part1 .btn, .part1 .dropdown"),planet1=$(".part1 .planet.p_1"),planet2=$(".part1 .planet.p_2"),planet3=$(".part1 .planet.p_3"),flyman=$(".flyman"),rocket=$(".part1 .rocket"),satellite=$(".part1 .satellite"),planetObj=$(".part2 .planetBox ul"),three=$(".part2 .slick"),threeLocation=$(".vote .location_name"),vote_box=$(".part2.vote .vote_box"),delayTime=.75,wheelPos="top",fb_login=$.cookie("fb_login")?!0:!1,gplus_login=$.cookie("gplus_login")?!0:!1,popupOpen=!1,resizeFG=!1,innerFG=!1,store_fg=!1,store_number=0,indexCtrl={init:function(){var e=this;$.each(profile,function(e,o){$.preload(o.img1)}),e.updateData(),e.initSlick(),e.initRA(),$(".dropdown dt a").on("click",function(e){menuCtrl.preventAll(e),$(".dropdown dd ul").slideToggle("fast")}),$(".dropdown dd ul li").on("click",function(e){menuCtrl.preventAll(e);var o=$(this).find("a").text(),t=$(this).index();store_number=t,store_fg=!0,$(".dropdown dt a").text(o),$(".dropdown dd ul").hide()}),startBtn.click(function(o){return menuCtrl.preventAll(o),menuCtrl.timeLimit()?menuCtrl.timesUp()?store_fg?(e.outStage(),void $(".part1 .btn .shape").toggleClass("shape_border")):void alert("請先選擇分店！"):void alert("此投票活動已結束，感謝您的熱情參與！"):void alert("現在投票還沒有開始喔！\n\n請於\n106年 8月  7日（一）11:00～\n106年 8月20日（日）23:59\n\n蒞臨本站一天一票，支持您心目中的候選人！")}),$(".pop .close, .store_list .close, .warn .close").on("click",function(e){menuCtrl.preventAll(e),popupOpen=!1;var o=$(this).parent("div").attr("class");o.indexOf("login")>-1&&gaclick("login_x"),o.indexOf("final_check")>-1&&gaclick("vote_go_x"),$(this).parent("div").fadeOut("fast",function(){$(".store_list").css("z-index",501)}),innerFG?$(".pop_black").fadeOut("fast"):$(".black").fadeOut("fast"),innerFG=!1}),$(window).on("resize",function(){e.indexResize()}).on("load",function(){$("header, .wrap").css("opacity",1),e.inStage(),e.indexResize(),menuCtrl.chkDevice()||TweenMax.from(rocket,2,{top:"30%",left:"50%",opacity:0,delay:.35,transform:"scale(.5) rotate(-90deg)",delay:delayTime,ease:Power2.easeOut,onComplete:function(){TweenMax.set(rocket,{clearProps:"all"})}}),$(".loading").delay(300).fadeOut("fast")}),gapage("index")},indexResize:function(){$(window).width()>600?flyman.addClass("move"):(wheelPos="mobile",flyman.removeClass("move"))},updateData:function(){$.get("../api/angel_list",function(e){$.each(e,function(e,o){profile[e].vote_cnt=o.vote_cnt})})},outStage:function(){gaclick("index_vote");var e=this;TweenMax.staggerTo([home1,home2,home3],.5,{scaleY:0,y:200,ease:Back.easeIn},.1),TweenMax.to(earth,.5,{y:200,ease:Back.easeIn,delay:.3}),TweenMax.staggerTo([title,redword,content],.5,{opacity:0,y:-100},.2),TweenMax.to(planet1,.5,{x:-500,ease:Back.easeIn}),TweenMax.staggerTo([planet2,planet3],.5,{x:500,ease:Back.easeIn},.1),TweenMax.to(indexBtn,.5,{opacity:0}),TweenMax.to(rocket,1,{top:"-20%",left:"5%",transform:"scale(.1)",ease:Back.easeIn}),TweenMax.to(satellite,1,{top:"-10%",left:"50%",transform:"scale(.1)",ease:Back.easeIn}),TweenMax.to($(".part1"),.25,{display:"none",opacity:"0",delay:1,onComplete:function(){e.initPart2()}})},inStage:function(){TweenMax.staggerFrom([home1,home2,home3],.5,{scaleY:0,y:200,ease:Back.easeOut,delay:delayTime},.1),TweenMax.from(earth,.5,{y:200,ease:Back.easeOut,delay:delayTime}),TweenMax.staggerFrom([title,redword,content],.5,{opacity:0,y:-100,delay:delayTime},.2),TweenMax.from(indexBtn,.5,{opacity:0,delay:delayTime+.5}),TweenMax.from(planet1,.5,{x:-500,ease:Back.easeOut,delay:delayTime,onComplete:function(){TweenMax.set(planet1,{clearProps:"all"})}}),TweenMax.staggerFrom([planet2,planet3],.5,{x:500,ease:Back.easeOut,delay:delayTime,onComplete:function(){TweenMax.set([planet2,planet3],{clearProps:"all"})}},.1)},initSlick:function(){three.slick({centerMode:!1,centerPadding:"5px",slidesToShow:3,responsive:[{breakpoint:600,settings:{initialSlide:1,arrows:!1,infinite:!1,centerMode:!0,centerPadding:"33%",slidesToShow:1}}]})},initRA:function(){var e=this;planetObj.roundabout({duration:400,startingChild:0,responsive:!0,minOpacity:1,maxOpacity:1,shape:"rollerCoaster",clickToFocus:!1}).bind("animationStart",function(){var e=planetObj.roundabout("getChildInFocus");if("down"==wheelPos){var o=e+1;o>=16&&(o=0),TweenMax.to($(".roundabout-moveable-item").eq(o),.5,{scale:1,filter:"brightness(100%)"}),TweenMax.to($(".roundabout-in-focus"),.5,{scale:.5,filter:"brightness(30%)"})}else if("top"==wheelPos){var t=e-1;-1>=t&&(t=15),TweenMax.to($(".roundabout-moveable-item").eq(t),.5,{scale:1,filter:"brightness(100%)"}),TweenMax.to($(".roundabout-in-focus"),.5,{scale:.5,filter:"brightness(30%)"})}TweenMax.to([three,threeLocation],.3,{opacity:0,onComplete:function(){three.slick("slickGoTo",1,!0)}})}).bind("animationEnd",function(){var o=planetObj.roundabout("getChildInFocus");$("aside li").find("a").removeClass("focus"),$("aside li").find("a").eq(o).addClass("focus");var t=o+1;e.setProfile(o),gaclick("shop_"+t)}),TweenMax.to($(".roundabout-moveable-item"),.5,{scale:.5,filter:"brightness(30%)"}),TweenMax.to($(".roundabout-in-focus"),.3,{scale:1,filter:"brightness(100%)",onComplete:function(){}})},initPart2:function(){var e=this;e.winWheel(),e.checkChoose(),e.setProfile(store_number),$.each(profile,function(e,o){$.preload(o.img2),$.preload(o.img3),$.preload(o.img4)}),$("aside.part2").removeClass("none"),$("aside li").on("click",function(o){menuCtrl.preventAll(o);{var t=$(this).index();planetObj.roundabout("getChildInFocus")}$("aside li").find("a").removeClass("focus"),$(this).find("a").addClass("focus"),TweenMax.to($(".roundabout-moveable-item"),.5,{scale:.5,filter:"brightness(30%)",delay:.1}),TweenMax.to($(".roundabout-moveable-item").eq(t),.5,{scale:1,filter:"brightness(100%)",delay:.1}),planetObj.roundabout("animateToChild",t,function(){e.setProfile(t)})}),$(".progress ul li").on("click",function(e){menuCtrl.preventAll(e);var o=$(this).index();trackWaitJump("","general.html?tag="+o)}),$(".store_list p a:eq(0)").on("click",function(e){menuCtrl.preventAll(e),wheelPos="top",planetObj.roundabout("animateToPreviousChild")}),$(".store_list p a:eq(1)").on("click",function(e){menuCtrl.preventAll(e),wheelPos="down",planetObj.roundabout("animateToNextChild")}),$(".store_list .location").on("click",function(e){menuCtrl.preventAll(e),$(".store_list").css("z-index",710),$(".store_list .name").fadeIn("fast")}),$(".store_list .name li").on("click",function(e){menuCtrl.preventAll(e);var o=$(this).index();$(".store_list").css("z-index",501),$(".store_list .name").fadeOut("fast",function(){TweenMax.to($(".roundabout-moveable-item"),.5,{scale:.5,filter:"brightness(30%)",delay:.1}),TweenMax.to($(".roundabout-moveable-item").eq(o),.5,{scale:1,filter:"brightness(100%)",delay:.1}),planetObj.roundabout("animateToChild",o)})}),three.find(".photo").on("click",function(o){menuCtrl.preventAll(o),popupOpen=!0,e.setPersonal($(this).data("index"),$(this).data("type"))}),three.find(".btnVote").on("click",function(o){menuCtrl.preventAll(o);var t=$(this).data("index"),n=$(this).data("type");return menuCtrl.timesUp()?fb_login||gplus_login?($.each(profile,function(e,o){o.chooseFG=!1}),void e.checkChoose(t,n)):(popupOpen=!0,$(".pop.login, .black").fadeIn("fast"),void e.openLogin()):void alert("此投票活動已結束，感謝您的熱情參與！")}),$(".progress .finish").on("click",function(e){if(menuCtrl.preventAll(e),!$(this).hasClass("no")){if(popupOpen=!0,!menuCtrl.timesUp())return void alert("此投票活動已結束，感謝您的熱情參與！");var o=$(".finalCheck li"),t=[$.cookie("choose1"),$.cookie("choose2"),$.cookie("choose3")];$.each(t,function(e){o.eq(e).find("img").attr("src",profile[t[e]].img1),o.eq(e).find("h1").text(profile[t[e]].name).append("<span>"+profile[t[e]].store_nm+"</span>"),e===t.length-1&&$(".pop.final_check, .black").fadeIn("fast")}),gaclick("vote_go")}}),$(".finalCheck .votebtn").on("click",function(e){menuCtrl.preventAll(e),menuCtrl.sendData(function(){$(".final_check .finalCheck, .final_check .close").fadeOut("fast",function(){$(".final_check .beenVote").fadeIn("fast")})})}),$(".final_check .beenVote .votebtn").on("click",function(e){menuCtrl.preventAll(e),trackWaitJump("ok_goback","index.html")}),TweenMax.to($(".roundabout-moveable-item"),.5,{scale:.5,filter:"brightness(30%)",delay:.1}),TweenMax.to($(".roundabout-moveable-item").eq(store_number),.5,{scale:1,filter:"brightness(100%)",delay:.1}),planetObj.roundabout("animateToChild",store_number),TweenMax.to($(".part2"),.5,{opacity:1,delay:.5,onComplete:function(){}})},setProfile:function(e){var o=3*e,t=$(".vote .vote_box.first"),n=$(".vote .vote_box.second"),i=$(".vote .vote_box.third"),a=[t,n,i];threeLocation.find(".words").text(profile[o].store_nm),$.each(a,function(e,t){t.find("h2").text(profile[o+e].name),t.find("img").attr("src",profile[o+e].img1),t.find(".vote_cnt").text(profile[o+e].vote_cnt),t.find(".photo").data("index",profile[o+e].index).data("type",profile[o+e].store_tp),t.find(".btnVote").data("index",profile[o+e].index).data("type",profile[o+e].store_tp),1==profile[o+e].chooseFG?(t.find(".btnVote").addClass("choose"),t.find(".btnVote").find("span").text("已選取"),t.find(".btnVote").find("path").removeClass("shape").removeClass("shape_border")):(t.find(".btnVote").removeClass("choose"),t.find(".btnVote").find("span").html('<b class="icon-love"></b>投票'),t.find(".btnVote").find("path").addClass("shape").addClass("shape_border")),e===a.length-1&&TweenMax.to([three,threeLocation],.3,{opacity:1,delay:.35})})},setPersonal:function(e,o){var t=this,n=$(".personal"),i="",a=profile[e].name,l=-1!==location.pathname.split("?")[0].indexOf("html")?location.pathname.split("?")[0]:"/index.html",r="https://"+location.hostname+l+"?name="+a;"A"===o?i="自營組":"B"===o?i="專櫃組":"C"===o&&(i="警衛清潔組"),""===profile[e].img4?$(".personal .photo_block li:eq(3)").addClass("none").hide():$(".personal .photo_block li:eq(3)").removeClass("none").show(),$(".personal .photo_block img").attr("src","img/store/"+profile[e].store_no+"_"+profile[e].store_tp+"_02.jpg"),$(".personal .photo_block li").find("a").removeClass("focus").eq(0).addClass("focus"),$(".personal .photo_block li").off("click"),$(".personal .votebtn").off("click"),n.find("h1").text(profile[e].name).append("<span>"+profile[e].store_nm+" / "+profile[e].career_nm+"</span>"),n.find("h2").text(profile[e].service_words),n.find(".tag").text(i),n.find(".vote_cnt").text(profile[e].vote_cnt),n.find(".votebtn").data("index",profile[e].index).data("type",profile[e].store_tp),n.find(".fb_comment").html('<fb:comments href="'+r+'" num_posts="5" width="100%"></fb:comments>'),FB.XFBML.parse(n.find(".fb_comment")[0]),$(".personal .photo_block li").on("click",function(o){if(menuCtrl.preventAll(o),!$(this).find("a").hasClass("focus")){var t=$(this).index()+2;$(".personal .photo_block li").find("a").removeClass("focus"),$(this).find("a").addClass("focus"),t>$(".personal .photo_block li:not(.none)").size()&&(t=1),TweenMax.to($(".personal .photo_block img"),.3,{opacity:0,onComplete:function(){$(".personal .photo_block img").attr("src","img/store/"+profile[e].store_no+"_"+profile[e].store_tp+"_0"+t+".jpg"),TweenMax.to($(".personal .photo_block img"),.3,{opacity:1})}})}}),$(".personal .votebtn").on("click",function(e){menuCtrl.preventAll(e);var o=$(this).data("index"),n=$(this).data("type");return menuCtrl.timesUp()?fb_login||gplus_login?(t.checkChoose(o,n),void $(".pop.personal, .black").delay(100).fadeOut("fast")):(popupOpen=!0,innerFG=!0,$(".pop.login, .pop_black").fadeIn("fast"),void t.openLogin()):void alert("此投票活動已結束，感謝您的熱情參與！")}),$(".pop.personal, .black").fadeIn("fast")},openLogin:function(){$(".login_fb").on("click",function(e){menuCtrl.preventAll(e),menuCtrl.fbLogin()}),menuCtrl.googleLogin($(".login_google"))},checkChoose:function(e,o){var t=this;if(!menuCtrl.timesUp())return void alert("此投票活動已結束，感謝您的熱情參與！");"A"===o?$.cookie("choose1",e):"B"===o?$.cookie("choose2",e):"C"===o&&$.cookie("choose3",e);var n=$.cookie("choose1"),i=$.cookie("choose2"),a=$.cookie("choose3"),l=[n,i,a],r=e?parseInt(e):0,s=parseInt(Math.floor(r/3));$.each(l,function(e,o){o&&(profile[o].chooseFG=!0),e==l.length-1&&t.setProfile(s)}),n?$(".progress .icon-checkmark:eq(0)").removeClass("unfinish"):$(".progress .icon-checkmark:eq(0)").addClass("unfinish"),i?$(".progress .icon-checkmark:eq(1)").removeClass("unfinish"):$(".progress .icon-checkmark:eq(1)").addClass("unfinish"),a?$(".progress .icon-checkmark:eq(2)").removeClass("unfinish"):$(".progress .icon-checkmark:eq(2)").addClass("unfinish"),n&&i&&a&&$(".progress .finish").removeClass("no")},winWheel:function(){function e(e){o&&window.clearTimeout(o),popupOpen||resizeFG||(o=window.setTimeout(function(){e=e||window.event,e.wheelDelta<=0||e.detail>0?(wheelPos="down",planetObj.roundabout("animateToNextChild")):(wheelPos="top",planetObj.roundabout("animateToPreviousChild"))},250))}var o;"onmousewheel"in window?window.onmousewheel=e:"onmousewheel"in document?document.onmousewheel=e:"addEventListener"in window&&(window.addEventListener("mousewheel",e,!1),window.addEventListener("DOMMouseScroll",e,!1))}};$(function(){indexCtrl.init()});